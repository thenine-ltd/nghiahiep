!function(t,e){var o=wp.media;o.view.OffloadButton=o.view.Button.extend({defaults:{text:"",style:"primary",size:"large",disabled:!1},initialize:function(t){t&&(this.options=t,this.defaults.text=as3cfpro_media.strings[this.options.action]),this.options=e.extend({},this.defaults,this.options),o.view.Button.prototype.initialize.apply(this,arguments),this.controller.on("selection:toggle",this.toggleDisabled,this),this.controller.on("select:activate",this.toggleDisabled,this)},render:function(){return o.view.Button.prototype.render.apply(this,arguments),this.toggleDisabled(),this},toggleDisabled:function(){this.controller.state().get("selection").length>0?this.$el.removeClass("disabled"):this.$el.addClass("disabled")},click:function(t){t.preventDefault();var o=this.controller.state().get("selection"),i=o.models,s=this.controller.state().get("library");if(!this.$el.hasClass("disabled")&&o.length){var l={_ajax_nonce:as3cfpro_media.nonces[this.options.scope+"_"+this.options.action],scope:this.options.scope,s3_action:this.options.action,ids:e.pluck(i,"id")};this.startOffloadAction(),this.fireOffloadAction(l).done(function(){e.each(i,function(t){t.fetch()}),s._requery(!0)})}},startOffloadAction:function(){t(".media-toolbar .spinner").css("visibility","visible").show(),t(".media-toolbar-secondary .button").addClass("disabled"),t(".offload-buttons__submenu").addClass("hidden")},fireOffloadAction:function(t){return wp.ajax.send("as3cfpro_process_media_action",{data:t}).done(e.bind(this.returnOffloadAction,this))},returnOffloadAction:function(e){e&&""!==e&&(t(".as3cf-notice").remove(),t("#wp-media-grid h1").after(e)),this.controller.trigger("selection:action:done"),t(".media-toolbar .spinner").attr("style","").hide()}}),o.view.OffloadToggle=o.view.Button.extend({className:"offload-buttons__toggle",defaults:{style:"primary",size:"large",priority:-80,disabled:!0},initialize:function(){return o.view.Button.prototype.initialize.apply(this,arguments),this.controller.on("selection:toggle",this.toggleDisabled,this),this.controller.on("select:activate",this.toggleDisabled,this),t("body").on("click",this.blur),this},click:function(t){if(t.preventDefault(),!this.$el.hasClass("disabled")){var e=this.controller.content.get().toolbar;this.$el.toggleClass("opened"),e.$(".offload-buttons__submenu").toggleClass("hidden")}},blur:function(){var e=t(".media-toolbar .offload-buttons__toggle"),o=t(".media-toolbar .offload-buttons__submenu");e.hasClass("opened")&&!o.parent().is(":active, :hover")&&(o.addClass("hidden"),e.removeClass("opened"))},toggleDisabled:function(){var t=this.controller.state().get("selection").length>0;this.model.set("disabled",!t),t?this.$el.removeClass("disabled"):this.$el.addClass("disabled")}});var i=o.view.SelectModeToggleButton;o.view.SelectModeToggleButton=i.extend({toggleBulkEditHandler:function(){i.prototype.toggleBulkEditHandler.call(this,arguments);var t=this.controller.content.get().toolbar.$(".offload-buttons"),e=t.find(".offload-buttons__submenu");this.controller.isModeActive("select")?t.addClass("visible"):t.removeClass("visible"),e.length&&t.width(e.outerWidth())}}),o.view.OffloadLocationFilter=wp.media.view.AttachmentFilters.extend({id:"media-attachment-as3cf-location-filter",initialize:function(){this.createFilters(),e.extend(this.filters,this.options.filters);var o="";e(as3cfpro_media.filters.as3cf_location.options).each(function(i,s){"string"==typeof i?o+=t("<option></option>").val(s).html(i).wrap("<p>").parent().html():(o+='<optgroup label="'+s+'">',e(i).each(function(e,i){o+=t("<option></option>").val(i).html(e).wrap("<p>").parent().html()}),o+="</optgroup>")}),this.$el.html(o),this.listenTo(this.model,"change",this.select),this.select()},createFilters:function(){var t={};e(as3cfpro_media.filters.as3cf_location.options).each(function(o,i){"string"==typeof o?t[i]={text:o,props:{as3cf_location:i},priority:10}:e(o).each(function(e,o){t[o]={text:e,props:{as3cf_location:o},priority:10}})}),this.filters=t}}),o.view.OffloadAccessFilter=wp.media.view.AttachmentFilters.extend({id:"media-attachment-as3cf-access-filter",createFilters:function(){var t={};e(as3cfpro_media.filters.as3cf_access.options).each(function(e,o){t[o]={text:e,props:{as3cf_access:o},priority:10}}),this.filters=t}});var s=o.view.AttachmentsBrowser;o.view.AttachmentsBrowser=s.extend({createToolbar:function(){s.prototype.createToolbar.call(this);var t=as3cfpro_media.actions.bulk.shift(),i=new o.view.OffloadButton({action:t,classes:"offload-buttons__action-default",scope:"bulk",controller:this.controller}).render();if(as3cfpro_media.actions.bulk.length){var l=[];e(as3cfpro_media.actions.bulk).each(function(t){l.push(new o.view.OffloadButton({action:t,classes:"offload-buttons__action",scope:"bulk",controller:this.controller}).render())}.bind(this));var n=new o.view.OffloadToggle({controller:this.controller}).render(),a=new o.view.ButtonGroup({buttons:l,classes:"offload-buttons__submenu hidden"}).render();this.toolbar.set("OffloadButtons",new o.view.ButtonGroup({buttons:[i,a,n],classes:"offload-buttons",priority:-80}))}this.toolbar.set("offloadLocationFilter",new o.view.OffloadLocationFilter({controller:this.controller,model:this.collection.props,priority:-75})),this.toolbar.set("offloadAccessFilter",new o.view.OffloadAccessFilter({controller:this.controller,model:this.collection.props,priority:-75})),this.toolbar.render()}})}(jQuery,_);