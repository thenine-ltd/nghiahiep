!function(e){const t=e("#update-plugins-table,.wp-list-table.plugins"),n=function(e,n){this.data=e,this.parent=n,this.$check=t.find('.check-column [value="'+e.basename+'"]'),this.$row=this.$check.closest("tr"),this.$noticeContainer=null};n.prototype.checkAgainLink=function(){return' <span class="as3cf-dbrains-check-my-licence-again"><a href="#">'+as3cf_dbrains.strings.check_licence_again+"</a></span>"},n.prototype.hasLicenseErrors=function(){const e=this.isAddon()?this.parent.data.license:this.data.license;return!_.isEmpty(e.errors)},n.prototype.disableUpdateCheckbox=function(){t.is("#update-plugins-table")&&this.$check.prop({disabled:!0,checked:!1})},n.prototype.enableUpdateCheckbox=function(){t.is("#update-plugins-table")&&this.$check.prop({disabled:!1})},n.prototype.setNotice=function(e){this.$noticeContainer.find(".as3cf-licence-notice").remove(),this.$noticeContainer.append('<div class="as3cf-licence-notice update-message notice inline notice-warning notice-alt"><p class="as3cf-before">'+e+this.checkAgainLink()+"</p></div>")},n.prototype.clearNotice=function(){const t=this,n=this.$noticeContainer.find(".as3cf-licence-notice");e.when(n.fadeOut()).done(function(){n.remove(),t.$row.children().css("box-shadow",""),t.$noticeContainer.find(".update-message").show()})},n.prototype.render=function(){this.hasLicenseErrors()?(this.initNoticeContainer(),this.disableUpdateCheckbox(),this.$noticeContainer.find('.update-message:not(".as3cf-licence-notice")').hide(),this.setNotice(this.getLicenseNotice())):this.$noticeContainer&&(this.enableUpdateCheckbox(),this.clearNotice()),this.isAddon()||_.invoke(this.addons,"render")},n.prototype.initNoticeContainer=function(){if(!this.$noticeContainer){if(t.is("#update-plugins-table"))this.$noticeContainer=this.$row.find(".plugin-title");else{const e=t.find('.plugin-update-tr[data-plugin="'+this.data.basename+'"]');if(e.length)this.$noticeContainer=e.find(".plugin-update");else{const e=this.$row.children().length;this.$row.after('<tr class="plugin-update-tr '+this.$row.attr("class")+'" id="'+this.data.slug+'-update" data-slug="'+this.data.slug+'" data-plugin="'+this.data.basename+'" ><td colspan="'+e+'" class="plugin-update colspanchange"></td></tr>'),this.$row.children().css("box-shadow","none"),this.$noticeContainer=t.find('.plugin-update-tr[data-plugin="'+this.data.basename+'"] .plugin-update')}}this.$noticeContainer.on("click",".as3cf-dbrains-check-my-licence-again a",_.bind(this.checkLicenseAgain,this))}},n.prototype.getLicenseNotice=function(){let e="";return this.data.update_available&&(e=as3cf_dbrains.strings.update_available+" "),this.isAddon()?e+as3cf_dbrains.strings.requires_parent_licence.replace("%s",this.parent.data.name):e+_.values(this.data.license.errors).join("")},n.prototype.checkLicenseAgain=function(t){const n=this,i=e(t.target),s=e('<span class="spinner is-active as3cf-dbrains-licence-check-spinner" style="float:none; margin-top: -3px;"></span>');t.preventDefault(),i.hide().after(s),this.ajaxCheckLicense().done(function(e){n.isAddon()?(n.parent.data.license.errors=e.errors,n.parent.render()):(n.data.license.errors=e.errors,n.render())}).fail(function(){n.setNotice(as3cf_dbrains.strings.licence_check_problem)}).always(function(){s.remove()})},n.prototype.ajaxCheckLicense=function(){const t=this.isAddon()?this.parent.data.prefix:this.data.prefix;return e.ajax({url:ajaxurl,type:"POST",dataType:"json",cache:!1,data:{action:t+"_check_licence",nonce:as3cf_dbrains.nonces.check_licence}})},n.prototype.init=function(){this.render(),this.isAddon()||this.initAddons()},n.prototype.isAddon=function(){return!!this.parent},n.prototype.initAddons=function(){const e=this;this.addons=_.map(this.data.addons,function(t){return new n(t,e)}),_.invoke(this.addons,"init")},t.length&&e(function(){_.chain(as3cf_dbrains.plugins).map(function(e){return new n(e)}).invoke("init")})}(jQuery);